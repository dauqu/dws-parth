<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Admin Client</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .connection-panel {
            padding: 20px;
            background: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
        }
        .connection-panel input {
            padding: 10px;
            width: 300px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            margin-right: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn:hover { opacity: 0.9; }
        .tabs {
            display: flex;
            background: #34495e;
        }
        .tab {
            padding: 15px 30px;
            color: white;
            cursor: pointer;
            border-right: 1px solid #2c3e50;
        }
        .tab.active {
            background: #2c3e50;
        }
        .tab-content {
            display: none;
            padding: 20px;
        }
        .tab-content.active {
            display: block;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .info-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        .info-card h3 {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .info-card .value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .file-list, .service-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .list-item {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .list-item:hover {
            background: #f8f9fa;
        }
        .screen-viewer {
            text-align: center;
            background: #000;
            padding: 10px;
            border-radius: 4px;
        }
        .screen-viewer img {
            max-width: 100%;
            height: auto;
        }
        textarea {
            width: 100%;
            min-height: 400px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ•Ô∏è Remote Administration Tool</h1>
        </div>

        <div class="connection-panel">
            <input type="text" id="serverAddress" placeholder="Server address (e.g., localhost:8080)" value="localhost:8080">
            <button class="btn btn-success" onclick="connect()">Connect</button>
            <button class="btn btn-danger" onclick="disconnect()">Disconnect</button>
            <div id="statusDisplay" class="status" style="display:none;"></div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('system')">System Info</div>
            <div class="tab" onclick="showTab('files')">File Manager</div>
            <div class="tab" onclick="showTab('services')">Services</div>
            <div class="tab" onclick="showTab('screen')">Screen Viewer</div>
        </div>

        <div id="systemTab" class="tab-content active">
            <button class="btn btn-primary" onclick="getSystemInfo()">Refresh System Info</button>
            <div id="systemInfo" class="info-grid"></div>
        </div>

        <div id="filesTab" class="tab-content">
            <input type="text" id="filePath" placeholder="Path (e.g., C:\)" value="C:\" style="width: 400px; padding: 10px; margin-bottom: 10px;">
            <button class="btn btn-primary" onclick="listFiles()">List Files</button>
            <div id="fileList" class="file-list"></div>
        </div>

        <div id="servicesTab" class="tab-content">
            <button class="btn btn-primary" onclick="listServices()">List Services</button>
            <div id="serviceList" class="service-list"></div>
        </div>

        <div id="screenTab" class="tab-content">
            <button class="btn btn-primary" onclick="captureScreen()">Capture Screen</button>
            <button class="btn btn-success" onclick="startScreenStream()">Start Stream</button>
            <button class="btn btn-danger" onclick="stopScreenStream()">Stop Stream</button>
            <div class="screen-viewer">
                <img id="screenImage" src="" alt="Screen will appear here" style="display:none;">
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let streamInterval = null;

        function showStatus(message, isError = false) {
            const status = document.getElementById('statusDisplay');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
            status.style.display = 'block';
        }

        function connect() {
            const address = document.getElementById('serverAddress').value;
            ws = new WebSocket('ws://' + address + '/ws');
            
            ws.onopen = () => {
                showStatus('Connected to ' + address);
            };
            
            ws.onerror = (error) => {
                showStatus('Connection failed', true);
            };
            
            ws.onclose = () => {
                showStatus('Disconnected', true);
                ws = null;
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
                stopScreenStream();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        async function sendMessage(type, data = null) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                showStatus('Not connected to server', true);
                return null;
            }

            return new Promise((resolve, reject) => {
                ws.send(JSON.stringify({ type, data }));
                
                ws.onmessage = (event) => {
                    const response = JSON.parse(event.data);
                    resolve(response);
                };
            });
        }

        async function getSystemInfo() {
            const response = await sendMessage('system_info');
            if (response && response.data) {
                const info = response.data;
                document.getElementById('systemInfo').innerHTML = `
                    <div class="info-card">
                        <h3>CPU Usage</h3>
                        <div class="value">${info.cpu_usage.toFixed(2)}%</div>
                    </div>
                    <div class="info-card">
                        <h3>RAM Used</h3>
                        <div class="value">${(info.ram_used / 1024 / 1024 / 1024).toFixed(2)} GB</div>
                    </div>
                    <div class="info-card">
                        <h3>RAM Total</h3>
                        <div class="value">${(info.ram_total / 1024 / 1024 / 1024).toFixed(2)} GB</div>
                    </div>
                    <div class="info-card">
                        <h3>RAM Percent</h3>
                        <div class="value">${info.ram_percent.toFixed(2)}%</div>
                    </div>
                    <div class="info-card">
                        <h3>Disk Used</h3>
                        <div class="value">${(info.disk_used / 1024 / 1024 / 1024).toFixed(2)} GB</div>
                    </div>
                    <div class="info-card">
                        <h3>Disk Total</h3>
                        <div class="value">${(info.disk_total / 1024 / 1024 / 1024).toFixed(2)} GB</div>
                    </div>
                    <div class="info-card">
                        <h3>Hostname</h3>
                        <div class="value" style="font-size: 18px;">${info.hostname}</div>
                    </div>
                    <div class="info-card">
                        <h3>CPU Cores</h3>
                        <div class="value">${info.cpu_cores}</div>
                    </div>
                `;
                showStatus('System info refreshed');
            }
        }

        async function listFiles() {
            const path = document.getElementById('filePath').value;
            const response = await sendMessage('file_operation', {
                action: 'list',
                path: path
            });

            if (response && response.data && response.data.data) {
                const files = response.data.data;
                let html = '';
                files.forEach(file => {
                    const icon = file.is_dir ? 'üìÅ' : 'üìÑ';
                    const size = file.is_dir ? '' : (file.size / 1024).toFixed(2) + ' KB';
                    html += `
                        <div class="list-item">
                            <div>${icon} ${file.name}</div>
                            <div>${size}</div>
                        </div>
                    `;
                });
                document.getElementById('fileList').innerHTML = html;
                showStatus(`Listed ${files.length} items`);
            }
        }

        async function listServices() {
            const response = await sendMessage('service_operation', {
                action: 'list'
            });

            if (response && response.data && response.data.data) {
                const services = response.data.data;
                let html = '';
                services.forEach(svc => {
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${svc.display_name}</strong><br>
                                <small>${svc.name} - ${svc.status} (${svc.start_type})</small>
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="serviceAction('start', '${svc.name}')">Start</button>
                                <button class="btn btn-danger" onclick="serviceAction('stop', '${svc.name}')">Stop</button>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('serviceList').innerHTML = html;
                showStatus(`Listed ${services.length} services`);
            }
        }

        async function serviceAction(action, serviceName) {
            const response = await sendMessage('service_operation', {
                action: action,
                service_name: serviceName
            });

            if (response && response.data) {
                showStatus(response.data.message);
                setTimeout(() => listServices(), 1000);
            }
        }

        async function captureScreen() {
            const response = await sendMessage('screen_capture');
            if (response && response.data) {
                const img = document.getElementById('screenImage');
                img.src = 'data:image/jpeg;base64,' + response.data.image;
                img.style.display = 'block';
                showStatus('Screen captured');
            }
        }

        function startScreenStream() {
            if (streamInterval) return;
            streamInterval = setInterval(captureScreen, 1000);
            showStatus('Screen streaming started');
        }

        function stopScreenStream() {
            if (streamInterval) {
                clearInterval(streamInterval);
                streamInterval = null;
                showStatus('Screen streaming stopped');
            }
        }
    </script>
</body>
</html>
