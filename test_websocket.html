<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test - Centralized System</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #fff; }
        .log { background: #2d2d2d; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .info { color: #dcdcaa; }
        button { padding: 10px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a9e; }
        #deviceId { background: #2d2d2d; color: #fff; padding: 5px; border: 1px solid #007acc; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª WebSocket Test - Centralized System</h1>
    
    <div>
        <label>Device ID: <input type="text" id="deviceId" value="HarshaWeb" /></label>
    </div>
    
    <h2>Tests:</h2>
    <button onclick="testFileOperation()">ğŸ“ Test Files</button>
    <button onclick="testServiceOperation()">âš™ï¸ Test Services</button>
    <button onclick="testScreenCapture()">ğŸ–¥ï¸ Test Screen</button>
    <button onclick="testShellCommand()">ğŸ’» Test Shell</button>
    <button onclick="clearLog()">ğŸ—‘ï¸ Clear Log</button>
    
    <h2>Connection Status:</h2>
    <div id="status" class="log">Disconnected</div>
    
    <h2>Messages:</h2>
    <div id="log"></div>

    <script>
        let ws = null;
        let deviceId = 'HarshaWeb';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log ${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function connect() {
            deviceId = document.getElementById('deviceId').value;
            ws = new WebSocket('ws://localhost:8080/ws/frontend');
            
            ws.onopen = () => {
                document.getElementById('status').innerHTML = 'âœ… Connected';
                document.getElementById('status').className = 'log success';
                log('Connected to server', 'success');
            };
            
            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                log(`â¬…ï¸ Received: type=${msg.type}, device_id=${msg.device_id || 'N/A'}`, 'success');
                console.log('Received message:', msg);
                
                if (msg.type === 'device_list') {
                    log(`ğŸ“‹ Devices: ${JSON.stringify(msg.data.map(d => d.id))}`, 'info');
                } else if (msg.type === 'file_response') {
                    log(`ğŸ“ Files: ${msg.data?.data?.length || 0} items`, 'info');
                    console.log('Files:', msg.data);
                } else if (msg.type === 'service_response') {
                    log(`âš™ï¸ Services: ${msg.data?.data?.length || 0} services`, 'info');
                    console.log('Services:', msg.data);
                } else if (msg.type === 'screen_capture') {
                    log(`ğŸ–¥ï¸ Screen: ${msg.data?.image ? 'Image received' : 'No image'}`, 'info');
                } else if (msg.type === 'shell_response') {
                    log(`ğŸ’» Shell: ${msg.data?.output?.substring(0, 50)}...`, 'info');
                    console.log('Shell output:', msg.data);
                } else if (msg.type === 'error') {
                    log(`âŒ Error: ${msg.data?.message}`, 'error');
                }
            };
            
            ws.onerror = (error) => {
                log('âŒ WebSocket error', 'error');
                console.error(error);
            };
            
            ws.onclose = () => {
                document.getElementById('status').innerHTML = 'âŒ Disconnected';
                document.getElementById('status').className = 'log error';
                log('Disconnected from server', 'error');
            };
        }

        function send(type, data) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ Not connected!', 'error');
                return;
            }
            
            const msg = {
                type: type,
                device_id: deviceId,
                data: data
            };
            
            log(`â¡ï¸ Sending: type=${type}, device_id=${deviceId}`, 'info');
            ws.send(JSON.stringify(msg));
        }

        function testFileOperation() {
            log('ğŸ§ª Testing file operation...', 'info');
            send('file_operation', {
                action: 'list',
                path: 'C:\\Users'
            });
        }

        function testServiceOperation() {
            log('ğŸ§ª Testing service operation...', 'info');
            send('service_operation', {
                action: 'list'
            });
        }

        function testScreenCapture() {
            log('ğŸ§ª Testing screen capture...', 'info');
            send('screen_capture', {
                action: 'capture'
            });
        }

        function testShellCommand() {
            log('ğŸ§ª Testing shell command...', 'info');
            send('shell_command', {
                command: 'echo Hello from test',
                shell_type: 'powershell'
            });
        }

        // Auto-connect on load
        window.onload = () => {
            connect();
        };
    </script>
</body>
</html>
